---
title: "MLB MVP, ROY, and Cy Young Winners"
authors: "Henry Gliedman and Jaden Chant"
output: 
  flexdashboard::flex_dashboard:
    theme: 
      version: 4
      bootswatch: lux
runtime: shiny
---

```{r global, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(plotly)

mlb_mvp <- read_csv("data/mlb_mvp.csv") |>
  select(-...1)


mlb_roy <- read_csv("data/mlb_roy.csv") |>
  select(-...1, -Voting)


mlb_cya <- read_csv("data/mlb_cya.csv") |>
  select(-...1)




stat_choices_mvp <- function(only_pitchers) {
  if (only_pitchers) {
    return(c("Wins Above Replacement", "Games Played", "At Bats", "Runs Scored", "Hits", "Home Runs", "Runs Batted In", "Stolen Bases", "Bases on Balls", "Batting Average", "On Base Percentage", "On Base and Slugging %", "Slugging Percentage", "Vote PTS", 
             "Wins", "Losses", "Earned Run Average", "WHIP", "Games Pitched", "Games Started Pitched", "Saves", "Innings Pitched", "Hits Allowed", "Home Runs Allowed", "Base on Balls Allowed", "Strike Outs"))
  } else {
    return(c("Wins Above Replacement", "Games Played", "At Bats", "Runs Scored", "Hits", "Home Runs", "Runs Batted In", "Stolen Bases", "Bases on Balls", "Batting Average", "On Base Percentage", "On Base and Slugging %", "Slugging Percentage", "Vote PTS"))
  }
}

stat_choices_roy <- function(only_pitchers) {
  if (only_pitchers) {
    return(c("Wins Above Replacement", "Home Runs", "Runs Batted In", "Stolen Bases", "Batting Average", "On Base Percentage", "Slugging Percentage", 
             "Wins", "Losses", "Earned Run Average", "Saves", "Innings Pitched", "Strike Outs"))
  } else {
    return(c("Wins Above Replacement", "Home Runs", "Runs Batted In", "Stolen Bases", "Batting Average", "On Base Percentage", "Slugging Percentage"))
  }
}

cy_young_choices <- c("Wins Above Replacement","Wins","Losses","Saves","Earned Run Average","Innings Pitched","Strikeouts")
```


About
==========================
There are three major awards given out in Major League Baseball each year. The Most Valuable Player Award given to the best player. The Rookie of The Year given to the best first year player, and the Cy Young Award given to the best pitcher. All of these awards are voted on by a council of sports writers labeled the Baseball Writers Association of America, or the BWAA. Each year two players are given each award. One player from the National League, and one player from the American League.     The purpose of this shiny app is to provide an interactive experience for users to view the statistics of these award winners over history. All in an attempt to increase understanding of both how statistical trends have shifted throughout history among the best baseball players, and also how increased importance into statistics over time has altered voting trends, and what writers feel makes up an MVP. Note that definitions of all of our statistics can be found at the bottom of this page.

  The MVP award or most valuable player is Major League Baseball's way of recognizing the best overall player in each league in each given season. A player can be awarded up to 420 voting points from the writers of the BWAA. A large majority of the time the MVP award is given to the "most valuable" hitter, but it is possible for a pitcher to win. Play around with the different leagues, and pitching stats to get the most out of our application. 

  The Rookie of the Year Award is given to recognize Major League Baseball's best first year player in each league. A player can receive up to 150 Vote_PTS in a given year, meaning they won 100% of the first place voting share. This award operates very similarly to the MVP where it is commonplace for a position player to win, but it is possible for a pitcher to get ROTY if they have an amazing season on the mound.

The Cy Young Award is given out to each leagues best overall pitcher. This award can be won by a relief pitcher, but a large majority of the time it is won by a starter. A starting pitcher being the player who starts the game and pitches a large majority of the innings. A player can be awarded up to 210 Voting Points in a season making up 100% of the first place share. Some interesting pieces to our Cy Young charts would be to view the trends of Earned Run Average (ERA), Wins, and Walks (BB). Each of these statistics do a good job of visualizing how pitching has changed in the past century, and what voters care about.  


MVP
==========================


Inputs {.sidebar}
-------------------------



```{r, echo=FALSE}
inputPanel(
  uiOutput("stat_selector"),
  checkboxInput("nl_league", "National League Teams", value = TRUE),
  checkboxInput("al_league", "American League Teams", value = TRUE),
  checkboxInput("only_pitchers", "Only Pitchers", value = FALSE),
)

output$stat_selector <- renderUI({
  selectInput("mvp_stat", label = "Statistic",
              choices = stat_choices_mvp(input$only_pitchers), selected = isolate(input$mvp_stat))
})
```



Column {data-width=300}
-------------------------

```{r, echo=FALSE}
renderPlotly({
  req(input$mvp_stat)
  
  stat_name <- switch(input$mvp_stat,
                      "Slugging Percentage" = "SLG",
                      "At Bats" = "AB",
                      "Runs Scored" = "R",
                      "Vote PTS" = "Vote_PTS",
                      "Games Played" = "BS_G",
                      "Hits" = "BS_H",
                      "Home Runs" = "BS_HR",
                      "Bases on Balls" = "BS_BB",
                      "On Base and Slugging %" = "OPS",
                      "Wins Above Replacement" = "WAR",
                      "Batting Average" = "BA",
                      "On Base Percentage" = "OBP",
                      "Runs Batted In" = "RBI",
                      "Stolen Bases" = "SB",
                      "Wins" = "W",
                      "Losses" = "L",
                      "Earned Run Average" = "ERA",
                      "WHIP" = "WHIP",
                      "Games Pitched" = "PS_G",
                      "Games Started Pitched" = "GS",
                      "Saves" = "SV",
                      "Innings Pitched" = "IP",
                      "Hits Allowed" = "PS_H",
                      "Home Runs Allowed" = "PS_HR",
                      "Base on Balls Allowed" = "PS_BB",
                      "Strike Outs" = "SO")

  filtered_data <- mlb_mvp |> filter(!is.na(.data[[stat_name]]))
  
  filtered_data <- if (input$only_pitchers) {
    filtered_data |> filter(Pitcher)
  } else {
    filtered_data
  }
  
  filtered_data <- if(!input$nl_league & !input$al_league) {
    filtered_data
  } else if(!input$nl_league) {
    filtered_data |> filter(Lg == "AL")
  } else if(!input$al_league) {
    filtered_data |> filter(Lg == "NL")
  } else {
    filtered_data
  }
  
  plot <- plot_ly(
    filtered_data, x = ~Year, y = ~.data[[stat_name]],
    type = 'scatter',
    mode = 'markers',
    text = ~paste("Name:", Name, "<br>League:", Lg),
    hovertemplate = paste(
      "%{text}<br>",
      "Year: %{x}<br>",
    input$mvp_stat, ": %{y}<extra></extra>"
  )
  ) |>
     add_trace(
      type = 'scatter',
      mode = 'lines',
      y = ~fitted(loess(.data[[stat_name]] ~ Year, data = filtered_data)),
      line = list(color = 'blue'),
      text = "Regression"
    ) |>
    add_trace(
      x = c(1947, 1947),
      y = c(min(filtered_data[[stat_name]], na.rm = TRUE), max(filtered_data[[stat_name]], na.rm = TRUE)),
      type = 'scatter',
      mode = 'lines',
      line = list(color = "red", dash = "dash"),
      hoverinfo = 'text',
      text = "Jackie Robinson Breaks the Color Barrier",
      showlegend = FALSE
    )|>
    add_trace(
      x = c(1969, 1969),
      y = c(min(filtered_data[[stat_name]], na.rm = TRUE), max(filtered_data[[stat_name]], na.rm = TRUE)),
      type = 'scatter',
      mode = 'lines',
      line = list(color = "green", dash = "dash"),
      hoverinfo = 'text',
      text = "MLB Lowers The Mound Benefiting Hitters",
      showlegend = FALSE)|>
    add_trace(
      x = c(1973, 1973),
      y = c(min(filtered_data[[stat_name]], na.rm = TRUE), max(filtered_data[[stat_name]], na.rm = TRUE)),
      type = 'scatter',
      mode = 'lines',
      line = list(color = "orange", dash = "dash"),
      hoverinfo = 'text',
      text = "Introduction of the DH",
      showlegend = FALSE)|>
      add_trace(
      x = c(1994, 1994),
      y = c(min(filtered_data[[stat_name]], na.rm = TRUE), max(filtered_data[[stat_name]], na.rm = TRUE)),
      type = 'scatter',
      mode = 'lines',
      line = list(color = "pink", dash = "dash"),
      hoverinfo = 'text',
      text = "Steroid Era Begins",
      showlegend = FALSE)|>
    add_trace(
      x = c(2016, 2016),
      y = c(min(filtered_data[[stat_name]], na.rm = TRUE), max(filtered_data[[stat_name]], na.rm = TRUE)),
      type = 'scatter',
      mode = 'lines',
      line = list(color = "purple", dash = "dash"),
      hoverinfo = 'text',
      text = "Statcast System Introduced",
      showlegend = FALSE)|>
    layout(
      title = paste("MLB MVP Statistics:", input$mvp_stat),
      xaxis = list(title = "Year"),
      yaxis = list(title = input$mvp_stat),
      showlegend= F,
      shapes= list(
        list(
          type = "line",
          x0 = 1947,
          x1 = 1947,
          y0 = 0,
          y1 = 1,
          xref = "x",
          yref = "paper",
          line = list(color = "red", dash = "dash"),
          name = "MLB lowers the Mound, Benefitting Hitters"
        )
      )
      
    ) |>
    config(displayModeBar = FALSE)
  
  plot
})
```

```{r, echo=FALSE}
renderPlotly({
  req(input$mvp_stat)
  
  stat_name <- switch(input$mvp_stat,
                      "Slugging Percentage" = "SLG",
                      "At Bats" = "AB",
                      "Runs Scored" = "R",
                      "Vote PTS" = "Vote_PTS",
                      "Games Played" = "BS_G",
                      "Hits" = "BS_H",
                      "Home Runs" = "BS_HR",
                      "Bases on Balls" = "BS_BB",
                      "On Base and Slugging %" = "OPS",
                      "Wins Above Replacement" = "WAR",
                      "Batting Average" = "BA",
                      "On Base Percentage" = "OBP",
                      "Runs Batted In" = "RBI",
                      "Stolen Bases" = "SB",
                      "Wins" = "W",
                      "Losses" = "L",
                      "Earned Run Average" = "ERA",
                      "WHIP" = "WHIP",
                      "Games Pitched" = "PS_G",
                      "Games Started Pitched" = "GS",
                      "Saves" = "SV",
                      "Innings Pitched" = "IP",
                      "Hits Allowed" = "PS_H",
                      "Home Runs Allowed" = "PS_HR",
                      "Base on Balls Allowed" = "PS_BB",
                      "Strike Outs" = "SO")

  filtered_data <- if (input$only_pitchers) {
    mlb_mvp |> filter(Pitcher)
  } else {
    mlb_mvp
  }
  
  filtered_data <- if(!input$nl_league & !input$al_league) {
    filtered_data
  } else if(!input$nl_league) {
    filtered_data |> filter(Lg == "AL")
  } else if(!input$al_league) {
    filtered_data |> filter(Lg == "NL")
  } else {
    filtered_data
  }
  
  plot <- plot_ly(
    filtered_data, x = ~Vote_PTS, y = ~.data[[stat_name]],
    type = 'scatter',
    mode = 'markers',
    text = ~paste("Name:", Name, "<br>League:", Lg, "<br>Year:", Year),
    hovertemplate = paste(
      "%{text}<br>",
      "Voting Points: %{x}<br>",
      input$mvp_stat, ": %{y}<extra></extra>"
    )
  ) |> 
    layout(
      title = paste("MLB MVP Voting Points:", input$mvp_stat),
      xaxis = list(title = "Voting Points"),
      yaxis = list(title = input$mvp_stat)
    ) |>
    config(displayModeBar = FALSE)
  
  plot
})
```


Column {data-width=300}
-------------------------
```{r, echo = FALSE}
renderPlot({
  req(input$mvp_stat)
  
  stat_name <- switch(input$mvp_stat,
                      "Slugging Percentage" = "SLG",
                      "At Bats" = "AB",
                      "Runs Scored" = "R",
                      "Vote PTS" = "Vote_PTS",
                      "Games Played" = "BS_G",
                      "Hits" = "BS_H",
                      "Home Runs" = "BS_HR",
                      "Bases on Balls" = "BS_BB",
                      "On Base and Slugging %" = "OPS",
                      "Wins Above Replacement" = "WAR",
                      "Batting Average" = "BA",
                      "On Base Percentage" = "OBP",
                      "Runs Batted In" = "RBI",
                      "Stolen Bases" = "SB",
                      "Wins" = "W",
                      "Losses" = "L",
                      "Earned Run Average" = "ERA",
                      "WHIP" = "WHIP",
                      "Games Pitched" = "PS_G",
                      "Games Started Pitched" = "GS",
                      "Saves" = "SV",
                      "Innings Pitched" = "IP",
                      "Hits Allowed" = "PS_H",
                      "Home Runs Allowed" = "PS_HR",
                      "Base on Balls Allowed" = "PS_BB",
                      "Strike Outs" = "SO")

  filtered_data <- if (input$only_pitchers) {
    mlb_mvp |> filter(Pitcher)
  } else {
    mlb_mvp
  }
  
  filtered_data <- if(!input$nl_league & !input$al_league) {
    filtered_data
  } else if(!input$nl_league) {
    filtered_data |> filter(Lg == "AL")
  } else if(!input$al_league) {
    filtered_data |> filter(Lg == "NL")
  } else {
    filtered_data
  }
  
  MVPBoxplot <-filtered_data|>
  mutate(decade= str_extract(Year, "^\\d\\d\\d"))|>
  mutate(
    decade = case_when(
      decade=="191"~"10's",
      decade== "192"~"20's",
      decade=="193"~"30's",
      decade=="194"~"40's",
      decade=="195"~"50's",
      decade=="196"~"60's",
      decade=="197"~"70's", 
      decade=="198" ~"80's",
      decade== "199"~ "90's",
      decade=="200" ~ "2000's",
      decade=="201"~"2010's",
      decade== "202"~"2020's",
    ))|>
   mutate(decade= fct_relevel(factor(decade),"10's","20's","30's","40's","50's", "60's", "70's", "80's", "90's"))
  
  
  ggplot(MVPBoxplot, aes(x= decade, y = as.numeric(filtered_data[[stat_name]])))+
  geom_boxplot()+
  labs(x = "Decade", y = input$mvp_stat)+
  ggtitle(paste("MLB MVP Statistics:", input$mvp_stat, "by Decade"))
  
  
})
```


ROY
==========================

Inputs {.sidebar}
-------------------------



```{r, echo=FALSE}
inputPanel(
  uiOutput("stat_selector_roy"),
  checkboxInput("nl_league_roy", "National League Teams", value = TRUE),
  checkboxInput("al_league_roy", "American League Teams", value = TRUE),
  checkboxInput("only_pitchers_roy", "Only Pitchers", value = FALSE)
)

output$stat_selector_roy <- renderUI({
  selectInput("roy_stat", label = "Statistic",
              choices = stat_choices_roy(input$only_pitchers_roy), 
              selected = isolate(input$roy_stat))
})
```


Column {data-width = 200}
-------------------------

```{r, echo=FALSE}
renderPlotly({
  req(input$roy_stat)

  stat_name <- switch(input$roy_stat,
                      "Slugging Percentage" = "SLG",
                      "Home Runs" = "HR",
                      "Runs Batted In" = "RBI",
                      "Stolen Bases" = "SB",
                      "Batting Average" = "BA",
                      "On Base Percentage" = "OBP",
                      "Wins Above Replacement" = "WAR",
                      "Wins" = "W",
                      "Losses" = "L",
                      "Earned Run Average" = "ERA",
                      "Saves" = "SV",
                      "Innings Pitched" = "IP",
                      "Strike Outs" = "SO")

  filtered_data <- mlb_roy |> filter(!is.na(.data[[stat_name]]))
  
  filtered_data <- if (input$only_pitchers_roy) {
    filtered_data |> filter(Pitcher)
  } else {
    filtered_data
  }

  filtered_data <- if(!input$nl_league_roy & !input$al_league_roy) {
    filtered_data
  } else if(!input$nl_league_roy) {
    filtered_data |> filter(Lg == "AL")
  } else if(!input$al_league_roy) {
    filtered_data |> filter(Lg == "NL")
  } else {
    filtered_data
  }

  plot <- plot_ly(
    filtered_data, x = ~Year, y = ~.data[[stat_name]],
    type = 'scatter',
    mode = 'markers',
    text = ~paste("Name:", Name, "<br>League:", Lg),
    hovertemplate = paste(
      "%{text}<br>",
      "Year: %{x}<br>",
    input$roy_stat, ": %{y}<extra></extra>"
  )
  ) |>
     add_trace(
      type = 'scatter',
      mode = 'lines',
      y = ~fitted(loess(.data[[stat_name]] ~ Year, data = filtered_data)),
      line = list(color = 'blue'),
      text = "Regression"
    ) |>
    add_trace(
      x = c(1947, 1947),
      y = c(min(filtered_data[[stat_name]], na.rm = TRUE), max(filtered_data[[stat_name]], na.rm = TRUE)),
      type = 'scatter',
      mode = 'lines',
      line = list(color = "red", dash = "dash"),
      hoverinfo = 'text',
      text = "Jackie Robinson Breaks the Color Barrier",
      showlegend = FALSE
    )|>
    add_trace(
      x = c(1969, 1969),
      y = c(min(filtered_data[[stat_name]], na.rm = TRUE), max(filtered_data[[stat_name]], na.rm = TRUE)),
      type = 'scatter',
      mode = 'lines',
      line = list(color = "green", dash = "dash"),
      hoverinfo = 'text',
      text = "MLB Lowers The Mound Benefiting Hitters",
      showlegend = FALSE)|>
    add_trace(
      x = c(1973, 1973),
      y = c(min(filtered_data[[stat_name]], na.rm = TRUE), max(filtered_data[[stat_name]], na.rm = TRUE)),
      type = 'scatter',
      mode = 'lines',
      line = list(color = "orange", dash = "dash"),
      hoverinfo = 'text',
      text = "Introduction of the DH",
      showlegend = FALSE)|>
      add_trace(
      x = c(1994, 1994),
      y = c(min(filtered_data[[stat_name]], na.rm = TRUE), max(filtered_data[[stat_name]], na.rm = TRUE)),
      type = 'scatter',
      mode = 'lines',
      line = list(color = "pink", dash = "dash"),
      hoverinfo = 'text',
      text = "Steroid Era Begins",
      showlegend = FALSE)|>
    add_trace(
      x = c(2016, 2016),
      y = c(min(filtered_data[[stat_name]], na.rm = TRUE), max(filtered_data[[stat_name]], na.rm = TRUE)),
      type = 'scatter',
      mode = 'lines',
      line = list(color = "purple", dash = "dash"),
      hoverinfo = 'text',
      text = "Statcast System Introduced",
      showlegend = FALSE)|>
    layout(
      title = paste("MLB ROY Statistics:", input$roy_stat),
      xaxis = list(title = "Year"),
      yaxis = list(title = input$roy_stat),
      showlegend= F,
      shapes= list(
        list(
          type = "line",
          x0 = 1947,
          x1 = 1947,
          y0 = 0,
          y1 = 1,
          xref = "x",
          yref = "paper",
          line = list(color = "red", dash = "dash"),
          name = "MLB lowers the Mound, Benefitting Hitters"
        )
      )

    ) |>
    config(displayModeBar = FALSE)

  plot
})
```

Column {data-width = 200}
-------------------------

```{r, echo=FALSE}
renderPlot({
  req(input$roy_stat)

  stat_name <- switch(input$roy_stat,
                      "Slugging Percentage" = "SLG",
                      "Home Runs" = "HR",
                      "Runs Batted In" = "RBI",
                      "Stolen Bases" = "SB",
                      "Batting Average" = "BA",
                      "On Base Percentage" = "OBP",
                      "Wins Above Replacement" = "WAR",
                      "Wins" = "W",
                      "Losses" = "L",
                      "Earned Run Average" = "ERA",
                      "Saves" = "SV",
                      "Innings Pitched" = "IP",
                      "Strike Outs" = "SO")

  filtered_data <- if (input$only_pitchers_roy) {
    mlb_roy |> filter(Pitcher)
  } else {
    mlb_roy
  }
  
  filtered_data <- if(!input$nl_league_roy & !input$al_league_roy) {
    filtered_data
  } else if(!input$nl_league_roy) {
    filtered_data |> filter(Lg == "AL")
  } else if(!input$al_league_roy) {
    filtered_data |> filter(Lg == "NL")
  } else {
    filtered_data
  }
  
  ROYBoxplot <-filtered_data|>
  mutate(decade= str_extract(Year, "^\\d\\d\\d"))|>
  mutate(
    decade = case_when(
      decade=="191"~"10's",
      decade== "192"~"20's",
      decade=="193"~"30's",
      decade=="194"~"40's",
      decade=="195"~"50's",
      decade=="196"~"60's",
      decade=="197"~"70's", 
      decade=="198" ~"80's",
      decade== "199"~ "90's",
      decade=="200" ~ "2000's",
      decade=="201"~"2010's",
      decade== "202"~"2020's",
    ))|>
   mutate(decade= fct_relevel(factor(decade),"10's","20's","30's","40's","50's", "60's", "70's", "80's", "90's"))
  
  
  ggplot(ROYBoxplot, aes(x= decade, y = as.numeric(filtered_data[[stat_name]])))+
  geom_boxplot()+
  labs(x = "Decade", y = input$mvp_stat)+
  ggtitle(paste("MLB ROY Statistics:", input$roy_stat, "by Decade"))
  
})
```



Cy Young
==========================

Inputs {.sidebar}
-------------------------
```{r, echo=FALSE}
inputPanel(
  uiOutput("cy_stat_selector"),

  checkboxInput("cy_nl_league", "National League Teams", value = TRUE),
  checkboxInput("cy_al_league", "American League Teams", value = TRUE)
)

output$cy_stat_selector <- renderUI({
  selectInput("cya_stat", label = "Statistic",
              choices = cy_young_choices, selected = isolate(input$cya_stat))
})
```

Column {data-width = 200}
-------------------------

```{r, echo= F}
renderPlotly({
  req(input$cya_stat)
  
  cstat_name <- switch(input$cya_stat,
                      "Wins Above Replacement"= "WAR",
                      "Wins" = "W",
                      "Losses" = "L",
                      "Earned Run Average" = "ERA",
                      "Saves" = "SV",
                      "Innings Pitched" = "IP",
                      "Strikeouts" = "SO")

  filtered_data <- mlb_cya |> filter(!is.na(.data[[cstat_name]]))
  
  filtered_data <- if(!input$cy_nl_league & !input$cy_al_league) {
    filtered_data
  } else if(!input$cy_nl_league) {
    filtered_data |> filter(Lg == "AL")
  } else if(!input$cy_al_league) {
    filtered_data |> filter(Lg == "NL")
  } else {
    filtered_data
  }
  
  plot <- plot_ly(
    filtered_data, x = ~Year, y = ~.data[[cstat_name]],
    type = 'scatter',
    mode = 'markers',
    text = ~paste("Name:", Name, "<br>League:", Lg),
    hovertemplate = paste(
      "%{text}<br>",
      "Year: %{x}<br>",
    input$cya_stat, ": %{y}<extra></extra>"
  )) |>
     add_trace(
      type = 'scatter',
      mode = 'lines',
      y = ~fitted(loess(.data[[cstat_name]] ~ Year, data = filtered_data)),
      line = list(color = 'blue'),
      text = "Regression"
    ) |>
    add_trace(
      x = c(1969, 1969),
      y = c(min(filtered_data[[cstat_name]], na.rm = TRUE), max(filtered_data[[cstat_name]], na.rm = TRUE)),
      type = 'scatter',
      mode = 'lines',
      line = list(color = "green", dash = "dash"),
      hoverinfo = 'text',
      text = "MLB Lowers The Mound Benefiting Hitters",
      showlegend = FALSE)|>
    add_trace(
      x = c(1973, 1973),
      y = c(min(filtered_data[[cstat_name]], na.rm = TRUE), max(filtered_data[[cstat_name]], na.rm = TRUE)),
      type = 'scatter',
      mode = 'lines',
      line = list(color = "orange", dash = "dash"),
      hoverinfo = 'text',
      text = "Introduction of the DH",
      showlegend = FALSE)|>
      add_trace(
      x = c(1994, 1994),
      y = c(min(filtered_data[[cstat_name]], na.rm = TRUE), max(filtered_data[[cstat_name]], na.rm = TRUE)),
      type = 'scatter',
      mode = 'lines',
      line = list(color = "pink", dash = "dash"),
      hoverinfo = 'text',
      text = "Steroid Era Begins",
      showlegend = FALSE)|>
    add_trace(
      x = c(2016, 2016),
      y = c(min(filtered_data[[cstat_name]], na.rm = TRUE), max(filtered_data[[cstat_name]], na.rm = TRUE)),
      type = 'scatter',
      mode = 'lines',
      line = list(color = "purple", dash = "dash"),
      hoverinfo = 'text',
      text = "Statcast System Introduced",
      showlegend = FALSE)|>
    layout(
      title = paste("MLB Cy Young Statistics:", input$cya_stat),
      xaxis = list(title = "Year"),
      yaxis = list(title = input$cya_stat),
      showlegend= F
    ) |>
    config(displayModeBar = FALSE)
  
  plot
})

```

Column {data-width = 200}
-------------------------

```{r, echo=FALSE}
renderPlot({
    req(input$cya_stat)
  
  cstat_name <- switch(input$cya_stat,
                      "Wins Above Replacement"= "WAR",
                      "Wins" = "W",
                      "Losses" = "L",
                      "Earned Run Average" = "ERA",
                      "Saves" = "SV",
                      "Innings Pitched" = "IP",
                      "Strikeouts" = "SO")

    filtered_data <- mlb_cya
  
  filtered_data <- if(!input$cy_nl_league & !input$cy_al_league) {
    filtered_data
  } else if(!input$cy_nl_league) {
    filtered_data |> filter(Lg == "AL")
  } else if(!input$cy_al_league) {
    filtered_data |> filter(Lg == "NL")
  } else {
    filtered_data
  }
  
  cyaBoxplot <-filtered_data|>
  mutate(decade= str_extract(Year, "^\\d\\d\\d"))|>
  mutate(
    decade = case_when(
      decade=="195"~"50's",
      decade=="196"~"60's",
      decade=="197"~"70's", 
      decade=="198" ~"80's",
      decade== "199"~ "90's",
      decade=="200" ~ "2000's",
      decade=="201"~"2010's",
      decade== "202"~"2020's",
    ))|>
   mutate(decade= fct_relevel(factor(decade),"50's", "60's", "70's", "80's", "90's"))
  
  
  ggplot(cyaBoxplot, aes(x= decade, y = as.numeric(filtered_data[[cstat_name]])))+
  geom_boxplot()+
  labs(x = "Decade", y = input$cya_stat)+
  ggtitle(paste("MLB CYA Statistics:", input$cya_stat, "by Decade"))
})
```





Conclusion
==========================

The Rookie of the Year

